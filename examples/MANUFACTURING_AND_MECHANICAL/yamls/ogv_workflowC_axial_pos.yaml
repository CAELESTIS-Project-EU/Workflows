workflow_type: WORKFLOWS.AUTOMATION_ML.workflowC.execution
phases:
  Sampling:
    - Type: PHASES.SAMPLERS.CSV.run
      parameters:
        inputs_file: "{parameters.inputs_file}"
  PAM-COMPOSITE_Simulations:
    - Type: PHASES.SIMULATIONS.PAM_RTMf.run
      parameters:
        DoE_line: "{variables.DoE_line}"
        outputs_files_folder: "{variables.results_folder}/{variables.line_number}/RTM/"
        src_macros_folder: "{parameters.macros_folder}"
        machine: "{parameters.machine}"
        source_folder: "{parameters.source_folder}"
        RTM_base_name: "{parameters.RTM_base_name}"
        np: "{parameters.PAM_NP}"
    - Type: PHASES.SIMULATIONS.PAM_RTMc.run
      parameters:
        DoE_line: "{variables.DoE_line}"
        outputs_files_folder: "{variables.results_folder}/{variables.line_number}/Curing/"
        input_files_folder: "{variables.results_folder}/{variables.line_number}/RTM/"
        machine: "{parameters.machine}"
        source_folder: "{parameters.source_folder}"
        Curing_base_name: "{parameters.Curing_base_name}"
        RTM_base_name: "{parameters.RTM_base_name}"
        np: "{parameters.PAM_NP}"
        src_macros_folder: "{parameters.macros_folder}"
    - Type: PHASES.SIMULATIONS.PAM_DISTORTION.run
      parameters:
        DoE_line: "{variables.DoE_line}"
        outputs_files_folder: "{variables.results_folder}/{variables.line_number}/Distortion/"
        input_files_folder: "{variables.results_folder}/{variables.line_number}/Curing/"
        machine: "{parameters.machine}"
        source_folder: "{parameters.source_folder}"
        Distortion_Base_Name: "{parameters.Distortion_Base_Name}"
        Curing_base_name: "{parameters.Curing_base_name}"
        np: "1"
        src_macros_folder: "{parameters.macros_folder}"
        tools: "True"
  PAM-COMPOSITE_PostProcess:
    - Type: PHASES.POSTSIMULATION.pam_distorsion_postprocess.run
      parameters:
        line: "{variables.line_number}"
        step: "-1"
        rtm_folder: "{variables.results_folder}/{variables.line_number}/RTM/"
        curing_folder: "{variables.results_folder}/{variables.line_number}/Curing/"
        distorsion_folder: "{variables.results_folder}/{variables.line_number}/Distortion/"
        in_file_rtm: "CAELESTIS_RESULT.erfh5"
        in_file_dis: "CAELESTISD-STAGE2_RESULT.erfh5"
        path_out: "{variables.results_folder}"
        file_IN1: "CAELESTISD-STAGE1_RESULT.erfh5"
        file_IN2: "CAELESTISD-STAGE2_RESULT.erfh5"
        prefix: "Dist"
        file_OUT1: "Step1.erfh5"
        file_OUT2: "Step2.erfh5"
  Prepare_Data:
    - Type: PHASES.BEFORESIMULATION.alya.USECASEconvert_and_surrogate
      parameters:
        line: "{variables.line_number}"
        DoE_line: "{variables.DoE_line}"
        input_files_folder: "{variables.results_folder}/{variables.line_number}/Distortion/"
        output_files_folder: "{variables.simulation_wdir}/{variables.line_number}/Mechanical/"
        row_folder: "{variables.simulation_wdir}/{variables.line_number}/"
        Mechanical_Base_Name: "{parameters.Mechanical_Base_Name}"
        template_COUPONtool: "{parameters.template_COUPONtool}"
        lperm_path: "{parameters.lperm_path}"
        inp_path: "{parameters.inp_path}"
        voids_path: "{parameters.voids_path}"
  ALYA_Simulation:
    - Type: PHASES.SIMULATIONS.alya.simulation
      parameters:
        simulation_wdir: "{variables.simulation_wdir}/{variables.line_number}/Mechanical/{parameters.Mechanical_Base_Name}"
        name_sim: "{parameters.Mechanical_Base_Name}"
  ALYA_PostProcess:
    - Type: PHASES.POSTSIMULATION.alya.collect_results
      parameters:
        simulation_wdir: "{variables.simulation_wdir}/{variables.line_number}/Mechanical/{parameters.Mechanical_Base_Name}"
        name_sim: "{parameters.Mechanical_Base_Name}"
  ALYA_PostProcessMerge:
    - Type: PHASES.POSTSIMULATION.alya.write_results
      parameters:
        y: "{variables.y}"
        alya_output: "{outputs.alya_output}"
        results_folder: "{variables.results_folder}"
        sample_set: "{variables.sample_set}"
inputs: {}
outputs:
  alya_output:
    - path: "alya_output.txt"
    - overwrite: True
parameters:
  machine: HPCBSC
  macros_folder: /gpfs/scratch/bsce81/doe-ogv-14samples/esi_src
  inputs_file: /gpfs/scratch/bsce81/doe-ogv-14samples/generatedDOE.csv
  source_folder: /gpfs/scratch/bsce81/doe-ogv-14samples/process_manufacturing
  lperm_path: /gpfs/scratch/bsce81/doe-ogv-14samples/mechanical
  inp_path: /gpfs/scratch/bsce81/doe-ogv-14samples/mechanical
  voids_path: /gpfs/scratch/bsce81/doe-ogv-14samples/mechanical
  template_COUPONtool: /gpfs/scratch/bsce81/doe-ogv-14samples/template/template_inputs_USECASEconvert_ogv_axial_pos.yaml
  RTM_base_name: CAELESTIS
  Curing_base_name: CAELESTIS
  Distortion_Base_Name: CAELESTISD
  Mechanical_Base_Name: ogv
  PAM_NP: 48
